Œ
QC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Services\UserService.cs
	namespace 	
UserService
 
. 
Services 
{ 
public 

class 
UserService 
: 
IUserService +
{		 
private

 
readonly

 
IUserRepository

 (
_userRepository

) 8
;

8 9
public 
UserService 
( 
IUserRepository *
userRepository+ 9
)9 :
{ 	
_userRepository 
= 
userRepository ,
;, -
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
User& *
>* +
>+ ,
GetAllUsersAsync- =
(= >
)> ?
{ 	
return 
await 
_userRepository (
.( )
GetAllUsersAsync) 9
(9 :
): ;
;; <
} 	
public 
async 
Task 
< 
User 
> 
GetUserByIdAsync  0
(0 1
Guid1 5
id6 8
)8 9
{ 	
return 
await 
_userRepository (
.( )
GetUserByIdAsync) 9
(9 :
id: <
)< =
;= >
} 	
public 
async 
Task 
CreateUserAsync )
() *
User* .
user/ 3
)3 4
{ 	
await 
_userRepository !
.! "
CreateUserAsync" 1
(1 2
user2 6
)6 7
;7 8
} 	
public   
async   
Task   
UpdateUserAsync   )
(  ) *
User  * .
user  / 3
)  3 4
{!! 	
await"" 
_userRepository"" !
.""! "
UpdateUserAsync""" 1
(""1 2
user""2 6
)""6 7
;""7 8
}## 	
public%% 
async%% 
Task%% 
DeleteUserAsync%% )
(%%) *
Guid%%* .
id%%/ 1
)%%1 2
{&& 	
await'' 
_userRepository'' !
.''! "
DeleteUserAsync''" 1
(''1 2
id''2 4
)''4 5
;''5 6
}(( 	
})) 
}** Ê

YC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Repositories\IUserRepository.cs
	namespace 	
UserService
 
. 
Repositories "
{ 
public 

	interface 
IUserRepository $
{ 
Task		 
<		 
IEnumerable		 
<		 
User		 
>		 
>		 
GetAllUsersAsync		  0
(		0 1
)		1 2
;		2 3
Task

 
<

 
User

 
>

 
GetUserByIdAsync

 #
(

# $
Guid

$ (
id

) +
)

+ ,
;

, -
Task 
CreateUserAsync 
( 
User !
user" &
)& '
;' (
Task 
UpdateUserAsync 
( 
User !
user" &
)& '
;' (
Task 
DeleteUserAsync 
( 
Guid !
id" $
)$ %
;% &
Task 
< 
User 
? 
> 
GetUserByEmailAsync '
(' (
object( .
email/ 4
)4 5
;5 6
Task 
AddUserAsync 
( 
User 
user #
)# $
;$ %
} 
} ï
RC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Services\IUserService.cs
	namespace 	
UserService
 
. 
Services 
{ 
public 

	interface 
IUserService !
{ 
Task		 
<		 
IEnumerable		 
<		 
User		 
>		 
>		 
GetAllUsersAsync		  0
(		0 1
)		1 2
;		2 3
Task

 
<

 
User

 
>

 
GetUserByIdAsync

 #
(

# $
Guid

$ (
id

) +
)

+ ,
;

, -
Task 
CreateUserAsync 
( 
User !
user" &
)& '
;' (
Task 
UpdateUserAsync 
( 
User !
user" &
)& '
;' (
Task 
DeleteUserAsync 
( 
Guid !
id" $
)$ %
;% &
} 
} ≈!
XC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Repositories\UserRepository.cs
	namespace 	
UserService
 
. 
Repositories "
{ 
public		 

class		 
UserRepository		 
:		  !
IUserRepository		" 1
{

 
private 
readonly 
UserDbContext &
_context' /
;/ 0
public 
UserRepository 
( 
UserDbContext +
context, 3
)3 4
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
User& *
>* +
>+ ,
GetAllUsersAsync- =
(= >
)> ?
{ 	
return 
await 
_context !
.! "
Users" '
.' (
ToListAsync( 3
(3 4
)4 5
;5 6
} 	
public 
async 
Task 
< 
User 
> 
GetUserByIdAsync  0
(0 1
Guid1 5
id6 8
)8 9
{ 	
return 
await 
_context !
.! "
Users" '
.' (
	FindAsync( 1
(1 2
id2 4
)4 5
;5 6
} 	
public 
async 
Task 
CreateUserAsync )
() *
User* .
user/ 3
)3 4
{ 	
_context 
. 
Users 
. 
Add 
( 
user #
)# $
;$ %
await 
_context 
. 
SaveChangesAsync +
(+ ,
), -
;- .
}   	
public"" 
async"" 
Task"" 
UpdateUserAsync"" )
("") *
User""* .
user""/ 3
)""3 4
{## 	
_context$$ 
.$$ 
Users$$ 
.$$ 
Update$$ !
($$! "
user$$" &
)$$& '
;$$' (
await%% 
_context%% 
.%% 
SaveChangesAsync%% +
(%%+ ,
)%%, -
;%%- .
}&& 	
public(( 
async(( 
Task(( 
DeleteUserAsync(( )
((() *
Guid((* .
id((/ 1
)((1 2
{)) 	
var** 
user** 
=** 
await** 
_context** %
.**% &
Users**& +
.**+ ,
	FindAsync**, 5
(**5 6
id**6 8
)**8 9
;**9 :
if++ 
(++ 
user++ 
!=++ 
null++ 
)++ 
{,, 
_context-- 
.-- 
Users-- 
.-- 
Remove-- %
(--% &
user--& *
)--* +
;--+ ,
await.. 
_context.. 
... 
SaveChangesAsync.. /
(../ 0
)..0 1
;..1 2
}// 
}00 	
public22 
async22 
Task22 
<22 
User22 
?22 
>22  
GetUserByEmailAsync22! 4
(224 5
object225 ;
email22< A
)22A B
{33 
return44 

await44 
_context44 
.44 
Users44 
.44  
FirstOrDefaultAsync44  3
(443 4
u444 5
=>446 8
u449 :
.44: ;
Email44; @
==44A C
email44D I
)44I J
;44J K
}55 
public66 
async66 
Task66 
AddUserAsync66 
(66  
User66  $
user66% )
)66) *
{77 
_context88 
.88 
Users88 
.88 
Add88 
(88 
user88 
)88  
;88  !
await99 
_context99 
.99 
SaveChangesAsync99 '
(99' (
)99( )
;99) *
}:: 
}<< 
}== ÜD
DC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
WebHost 
. 
ConfigureKestrel  
(  !
options! (
=>) +
{ 
options 
. 
ListenAnyIP 
( 
$num 
) 
; 
} 
) 
; 
builder 
. 
Services 
. 
	Configure 
< 
JwtSettings &
>& '
(' (
builder( /
./ 0
Configuration0 =
.= >

GetSection> H
(H I
$strI V
)V W
)W X
;X Y
builder 
. 
Services 
. 
AddDbContext 
< 
UserDbContext +
>+ ,
(, -
options- 4
=>5 7
options 
. 
UseSqlServer 
( 
builder  
.  !
Configuration! .
.. /
GetConnectionString/ B
(B C
$strC V
)V W
,W X

sqlOptions 
=> 

sqlOptions  
.  ! 
EnableRetryOnFailure! 5
(5 6
)6 7
) 
) 
; 
builder 
. 
Services 
. 
	AddScoped 
< 
IUserRepository *
,* +
UserRepository, :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
	AddScoped 
< 
IUserService '
,' (
UserService) 4
.4 5
Services5 =
.= >
UserService> I
>I J
(J K
)K L
;L M
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder   
.   
Services   
.   
AddSwaggerGen   
(   
c    
=>  ! #
{!! 
c"" 
."" 

SwaggerDoc"" 
("" 
$str"" 
,"" 
new"" 
("" 
)"" 
{"" 
Title"" $
=""% &
$str""' 8
,""8 9
Version"": A
=""B C
$str""D H
}""I J
)""J K
;""K L
var$$ 
securityScheme$$ 
=$$ 
new$$ !
OpenApiSecurityScheme$$ 2
{%% 
Name&& 
=&& 
$str&& 
,&& 
Type'' 
='' 
SecuritySchemeType'' !
.''! "
Http''" &
,''& '
Scheme(( 
=(( 
$str(( 
,(( 
BearerFormat)) 
=)) 
$str)) 
,)) 
In** 

=** 
ParameterLocation** 
.** 
Header** %
,**% &
Description++ 
=++ 
$str++ M
,++M N
	Reference,, 
=,, 
new,, 
OpenApiReference,, (
{-- 	
Type.. 
=.. 
ReferenceType..  
...  !
SecurityScheme..! /
,../ 0
Id// 
=// 
$str// 
}00 	
}11 
;11 
c33 
.33 !
AddSecurityDefinition33 
(33 
$str33 $
,33$ %
securityScheme33& 4
)334 5
;335 6
c44 
.44 "
AddSecurityRequirement44 
(44 
new44  &
OpenApiSecurityRequirement44! ;
{55 
{66 	
securityScheme66
 
,66 
new66 
[66 
]66 
{66  !
$str66" *
}66+ ,
}66- .
}77 
)77 
;77 
}88 
)88 
;88 
builder:: 
.:: 
Services:: 
.:: 
AddAuthentication:: "
(::" #
options::# *
=>::+ -
{;; 
options<< 
.<< %
DefaultAuthenticateScheme<< %
=<<& '
JwtBearerDefaults<<( 9
.<<9 : 
AuthenticationScheme<<: N
;<<N O
options== 
.== "
DefaultChallengeScheme== "
===# $
JwtBearerDefaults==% 6
.==6 7 
AuthenticationScheme==7 K
;==K L
}>> 
)>> 
.?? 
AddJwtBearer?? 
(?? 
options?? 
=>?? 
{@@ 
varAA 
jwtSettingsAA 
=AA 
builderAA 
.AA 
ConfigurationAA +
.AA+ ,

GetSectionAA, 6
(AA6 7
$strAA7 D
)AAD E
.AAE F
GetAAF I
<AAI J
JwtSettingsAAJ U
>AAU V
(AAV W
)AAW X
;AAX Y
optionsBB 
.BB %
TokenValidationParametersBB %
=BB& '
newBB( +%
TokenValidationParametersBB, E
{CC 
ValidateIssuerDD 
=DD 
trueDD 
,DD 
ValidateAudienceEE 
=EE 
trueEE 
,EE  
ValidateLifetimeFF 
=FF 
trueFF 
,FF  $
ValidateIssuerSigningKeyGG  
=GG! "
trueGG# '
,GG' (
ValidIssuerHH 
=HH 
jwtSettingsHH !
.HH! "
IssuerHH" (
,HH( )
ValidAudienceII 
=II 
jwtSettingsII #
.II# $
AudienceII$ ,
,II, -
IssuerSigningKeyJJ 
=JJ 
newJJ  
SymmetricSecurityKeyJJ 3
(JJ3 4
EncodingJJ4 <
.JJ< =
UTF8JJ= A
.JJA B
GetBytesJJB J
(JJJ K
jwtSettingsJJK V
.JJV W
KeyJJW Z
)JJZ [
)JJ[ \
}KK 
;KK 
}LL 
)LL 
;LL 
builderNN 
.NN 
ServicesNN 
.NN 
AddAuthorizationNN !
(NN! "
)NN" #
;NN# $
varPP 
appPP 
=PP 	
builderPP
 
.PP 
BuildPP 
(PP 
)PP 
;PP 
appSS 
.SS 

UseRoutingSS 
(SS 
)SS 
;SS 
appUU 
.UU 
UseAuthenticationUU 
(UU 
)UU 
;UU 
appVV 
.VV 
UseAuthorizationVV 
(VV 
)VV 
;VV 
appXX 
.XX 

UseSwaggerXX 
(XX 
)XX 
;XX 
appYY 
.YY 
UseSwaggerUIYY 
(YY 
cYY 
=>YY 
{ZZ 
c[[ 
.[[ 
SwaggerEndpoint[[ 
([[ 
$str[[ 0
,[[0 1
$str[[2 F
)[[F G
;[[G H
c\\ 
.\\ 
RoutePrefix\\ 
=\\ 
string\\ 
.\\ 
Empty\\  
;\\  !
}]] 
)]] 
;]] 
app__ 
.__ 
UseEndpoints__ 
(__ 
	endpoints__ 
=>__ 
{`` 
	endpointsaa 
.aa 
MapControllersaa 
(aa 
)aa 
;aa 
}bb 
)bb 
;bb 
usingee 
(ee 
varee 

scopeee 
=ee 
appee 
.ee 
Servicesee 
.ee  
CreateScopeee  +
(ee+ ,
)ee, -
)ee- .
{ff 
vargg 
	dbContextgg 
=gg 
scopegg 
.gg 
ServiceProvidergg )
.gg) *
GetRequiredServicegg* <
<gg< =
UserDbContextgg= J
>ggJ K
(ggK L
)ggL M
;ggM N
	dbContexthh 
.hh 
Databasehh 
.hh 
Migratehh 
(hh 
)hh  
;hh  !
}ii 
appjj 
.jj 
Runjj 
(jj 
)jj 	
;jj	 
ü
HC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Models\User.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
User 
{ 
[ 	
Key	 
] 
public 
Guid 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
[

 	
Required

	 
]

 
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
FullName 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
Phone 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
Address 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
} 
} ‡
PC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Models\LoginRequest.cs
public 
class 
LoginRequest 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} Å	
OC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Models\JwtSettings.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
JwtSettings 
{ 
public 
string 
Key 
{ 
get 
;  
set! $
;$ %
}& '
=( )
string* 0
.0 1
Empty1 6
;6 7
public 
string 
Issuer 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Audience 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int 
ExpiryMinutes  
{! "
get# &
;& '
set( +
;+ ,
}- .
}		 
}

 ‹
dC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Migrations\20250506045053_InitialCreate.cs
	namespace 	
UserService
 
. 

Migrations  
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
UserId 
= 
table "
." #
Column# )
<) *
Guid* .
>. /
(/ 0
type0 4
:4 5
$str6 H
,H I
nullableJ R
:R S
falseT Y
)Y Z
,Z [
FullName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
	maxLengthK T
:T U
$numV Y
,Y Z
nullable[ c
:c d
falsee j
)j k
,k l
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 F
,F G
	maxLengthH Q
:Q R
$numS V
,V W
nullableX `
:` a
falseb g
)g h
,h i
PasswordHash  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> M
,M N
	maxLengthO X
:X Y
$numZ ]
,] ^
nullable_ g
:g h
falsei n
)n o
,o p
Phone 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 E
,E F
	maxLengthG P
:P Q
$numR T
,T U
nullableV ^
:^ _
false` e
)e f
,f g
Address 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
	maxLengthJ S
:S T
$numU X
,X Y
nullableZ b
:b c
falsed i
)i j
,j k
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= H
,H I
nullableJ R
:R S
falseT Y
)Y Z
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
UserId8 >
)> ?
;? @
} 
) 
; 
} 	
	protected!! 
override!! 
void!! 
Down!!  $
(!!$ %
MigrationBuilder!!% 5
migrationBuilder!!6 F
)!!F G
{"" 	
migrationBuilder## 
.## 
	DropTable## &
(##& '
name$$ 
:$$ 
$str$$ 
)$$ 
;$$ 
}%% 	
}&& 
}'' ∞
OC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Data\UserDbContext.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 
UserDbContext 
:  
	DbContext! *
{ 
public 
UserDbContext 
( 
DbContextOptions -
<- .
UserDbContext. ;
>; <
options= D
)D E
:		 
base		 
(		 
options		 
)		 
{		 
}		 
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
base 
. 
OnModelCreating  
(  !
modelBuilder! -
)- .
;. /
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
.' (
HasKey( .
(. /
u/ 0
=>1 3
u4 5
.5 6
UserId6 <
)< =
;= >
} 	
} 
} ã*
WC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Controllers\UserController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		 
)		 
]		 
public

 

class

 
UserController

 
:

  !
ControllerBase

" 0
{ 
private 
readonly 
IUserService %
_userService& 2
;2 3
public 
UserController 
( 
IUserService *
userService+ 6
)6 7
{ 	
_userService 
= 
userService &
;& '
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetAllUsers) 4
(4 5
)5 6
{ 	
try 
{ 	
var 
users 
= 
await 
_userService *
.* +
GetAllUsersAsync+ ;
(; <
)< =
;= >
return 
Ok 
( 
users 
) 
; 
} 	
catch
 
( 
	Exception 
ex 
) 
{ 	
return 

StatusCode 
( 
$num !
,! "
$"# %
$str% <
{< =
ex= ?
.? @
Message@ G
}G H
"H I
)I J
;J K
} 	
}   	
[!! 	
	Authorize!!	 
]!! 
["" 	
HttpGet""	 
("" 
$str"" 
)"" 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
GetUserById##) 4
(##4 5
Guid##5 9
id##: <
)##< =
{$$ 	
var%% 
user%% 
=%% 
await%% 
_userService%% )
.%%) *
GetUserByIdAsync%%* :
(%%: ;
id%%; =
)%%= >
;%%> ?
if&& 
(&& 
user&& 
==&& 
null&& 
)&& 
return'' 
NotFound'' 
(''  
)''  !
;''! "
return)) 
Ok)) 
()) 
user)) 
))) 
;)) 
}** 	
[++ 	
	Authorize++	 
]++ 
[,, 	
HttpPost,,	 
],, 
public-- 
async-- 
Task-- 
<-- 
IActionResult-- '
>--' (

CreateUser--) 3
(--3 4
User--4 8
user--9 =
)--= >
{.. 	
user00 
.00 
PasswordHash00 
=00 
BCrypt00  &
.00& '
Net00' *
.00* +
BCrypt00+ 1
.001 2
HashPassword002 >
(00> ?
user00? C
.00C D
PasswordHash00D P
)00P Q
;00Q R
await11 
_userService11 
.11 
CreateUserAsync11 .
(11. /
user11/ 3
)113 4
;114 5
return22 
CreatedAtAction22 "
(22" #
nameof22# )
(22) *
GetUserById22* 5
)225 6
,226 7
new228 ;
{22< =
id22> @
=22A B
user22C G
.22G H
UserId22H N
}22O P
,22P Q
user22R V
)22V W
;22W X
}33 	
[44 	
	Authorize44	 
]44 
[55 	
HttpPut55	 
(55 
$str55 
)55 
]55 
public66 
async66 
Task66 
<66 
IActionResult66 '
>66' (

UpdateUser66) 3
(663 4
Guid664 8
id669 ;
,66; <
User66= A
user66B F
)66F G
{77 	
if88 
(88 
id88 
!=88 
user88 
.88 
UserId88 !
)88! "
return99 

BadRequest99 !
(99! "
)99" #
;99# $
await;; 
_userService;; 
.;; 
UpdateUserAsync;; .
(;;. /
user;;/ 3
);;3 4
;;;4 5
return<< 
	NoContent<< 
(<< 
)<< 
;<< 
}== 	
[>> 	
	Authorize>>	 
]>> 
[?? 	

HttpDelete??	 
(?? 
$str?? 
)?? 
]?? 
public@@ 
async@@ 
Task@@ 
<@@ 
IActionResult@@ '
>@@' (

DeleteUser@@) 3
(@@3 4
Guid@@4 8
id@@9 ;
)@@; <
{AA 	
awaitBB 
_userServiceBB 
.BB 
DeleteUserAsyncBB .
(BB. /
idBB/ 1
)BB1 2
;BB2 3
returnCC 
	NoContentCC 
(CC 
)CC 
;CC 
}DD 	
}EE 
}FF õ=
WC:\Users\msi bravo\Desktop\FoodOrderingSystem\UserService\Controllers\AuthController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserRepository (
_userRepository) 8
;8 9
private 
readonly 
JwtSettings $
_jwtSettings% 1
;1 2
public 
AuthController 
( 
IUserRepository -
userRepository. <
,< =
IOptions> F
<F G
JwtSettingsG R
>R S
jwtSettingsT _
)_ `
{ 	
_userRepository 
= 
userRepository ,
;, -
_jwtSettings 
= 
jwtSettings &
.& '
Value' ,
;, -
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Register) 1
(1 2
[2 3
FromBody3 ;
]; <
User= A
requestB I
)I J
{ 	
var!! 
existingUser!! 
=!! 
await!! $
_userRepository!!% 4
.!!4 5
GetUserByEmailAsync!!5 H
(!!H I
request!!I P
.!!P Q
Email!!Q V
)!!V W
;!!W X
if"" 
("" 
existingUser"" 
!="" 
null""  $
)""$ %
{## 
return$$ 

BadRequest$$ !
($$! "
new$$" %
{$$& '
message$$( /
=$$0 1
$str$$2 X
}$$Y Z
)$$Z [
;$$[ \
}%% 
string(( 
hashedPassword(( !
=((" #
BCrypt(($ *
.((* +
Net((+ .
.((. /
BCrypt((/ 5
.((5 6
HashPassword((6 B
(((B C
request((C J
.((J K
PasswordHash((K W
)((W X
;((X Y
var++ 
user++ 
=++ 
new++ 
User++ 
{,, 
FullName-- 
=-- 
request-- "
.--" #
FullName--# +
,--+ ,
Email.. 
=.. 
request.. 
...  
Email..  %
,..% &
PasswordHash// 
=// 
hashedPassword// -
,//- .
Phone00 
=00 
request00 
.00  
Phone00  %
,00% &
Address11 
=11 
request11 !
.11! "
Address11" )
}22 
;22 
await55 
_userRepository55 !
.55! "
AddUserAsync55" .
(55. /
user55/ 3
)553 4
;554 5
return77 
Ok77 
(77 
new77 
{77 
message77 #
=77$ %
$str77& E
}77F G
)77G H
;77H I
}88 	
[:: 	
HttpPost::	 
(:: 
$str:: 
):: 
]:: 
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Login;;) .
(;;. /
[;;/ 0
FromBody;;0 8
];;8 9
LoginRequest;;: F
request;;G N
);;N O
{<< 	
var== 
user== 
=== 
await== 
_userRepository== ,
.==, -
GetUserByEmailAsync==- @
(==@ A
request==A H
.==H I
Email==I N
)==N O
;==O P
if?? 
(?? 
user?? 
==?? 
null?? 
||?? 
!??  !
BCrypt??! '
.??' (
Net??( +
.??+ ,
BCrypt??, 2
.??2 3
Verify??3 9
(??9 :
request??: A
.??A B
Password??B J
,??J K
user??L P
.??P Q
PasswordHash??Q ]
)??] ^
)??^ _
{@@ 
returnAA 
UnauthorizedAA #
(AA# $
newAA$ '
{AA( )
messageAA* 1
=AA2 3
$strAA4 O
}AAP Q
)AAQ R
;AAR S
}BB 
varDD 
tokenDD 
=DD 
GenerateTokenDD %
(DD% &
userDD& *
)DD* +
;DD+ ,
returnEE 
OkEE 
(EE 
newEE 
{EE 
TokenEE !
=EE" #
tokenEE$ )
}EE* +
)EE+ ,
;EE, -
}FF 	
privateHH 
stringHH 
GenerateTokenHH $
(HH$ %
UserHH% )
userHH* .
)HH. /
{II 	
varJJ 
claimsJJ 
=JJ 
newJJ 
[JJ 
]JJ 
{KK 
newLL 
ClaimLL 
(LL #
JwtRegisteredClaimNamesLL 1
.LL1 2
SubLL2 5
,LL5 6
userLL7 ;
.LL; <
UserIdLL< B
.LLB C
ToStringLLC K
(LLK L
)LLL M
)LLM N
,LLN O
newMM 
ClaimMM 
(MM #
JwtRegisteredClaimNamesMM 1
.MM1 2
EmailMM2 7
,MM7 8
userMM9 =
.MM= >
EmailMM> C
)MMC D
,MMD E
newNN 
ClaimNN 
(NN 
$strNN $
,NN$ %
userNN& *
.NN* +
FullNameNN+ 3
)NN3 4
,NN4 5
newOO 
ClaimOO 
(OO #
JwtRegisteredClaimNamesOO 1
.OO1 2
JtiOO2 5
,OO5 6
GuidOO7 ;
.OO; <
NewGuidOO< C
(OOC D
)OOD E
.OOE F
ToStringOOF N
(OON O
)OOO P
)OOP Q
}PP 
;PP 
varRR 
keyRR 
=RR 
newRR  
SymmetricSecurityKeyRR .
(RR. /
EncodingRR/ 7
.RR7 8
UTF8RR8 <
.RR< =
GetBytesRR= E
(RRE F
_jwtSettingsRRF R
.RRR S
KeyRRS V
)RRV W
)RRW X
;RRX Y
varSS 
credsSS 
=SS 
newSS 
SigningCredentialsSS .
(SS. /
keySS/ 2
,SS2 3
SecurityAlgorithmsSS4 F
.SSF G

HmacSha256SSG Q
)SSQ R
;SSR S
varUU 
tokenUU 
=UU 
newUU 
JwtSecurityTokenUU ,
(UU, -
issuerVV 
:VV 
_jwtSettingsVV $
.VV$ %
IssuerVV% +
,VV+ ,
audienceWW 
:WW 
_jwtSettingsWW &
.WW& '
AudienceWW' /
,WW/ 0
claimsXX 
:XX 
claimsXX 
,XX 
expiresYY 
:YY 
DateTimeYY !
.YY! "
UtcNowYY" (
.YY( )

AddMinutesYY) 3
(YY3 4
_jwtSettingsYY4 @
.YY@ A
ExpiryMinutesYYA N
)YYN O
,YYO P
signingCredentialsZZ "
:ZZ" #
credsZZ$ )
)[[ 
;[[ 
return]] 
new]] #
JwtSecurityTokenHandler]] .
(]]. /
)]]/ 0
.]]0 1

WriteToken]]1 ;
(]]; <
token]]< A
)]]A B
;]]B C
}^^ 	
}__ 
}`` 